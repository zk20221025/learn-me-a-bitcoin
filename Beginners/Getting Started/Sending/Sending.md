# 发送
进行您的第一笔比特币交易。

您已经*拥有了一些比特币*。现在您想将它们转移到另一个地址。

为此，您需要进行一笔**交易**。

1. 如何进行交易？
2. 进行交易时会发生什么？
3. 交易如何进入区块链？
4. 什么是交易费用？
5. 我应该等待多少确认？
6. 如何检查我的交易状态？

## 1. 如何进行交易？

这适用于您使用的任何*比特币钱包*：

1. **输入地址**。这是您要“发送”比特币的地方。
2. **输入金额**。您要发送的比特币数量。通常以BTC或Satoshis为单位。
3. **设置费用。（可选）**这将设置交易的“优先级”，以确定交易何时被最终确认。

然后只需点击“发送”即可完成。
![Sending-1.png](img/Sending-1%20(1).png)

从这里开始，你只需要等待交易被确认...

>**注意**：当你发送交易时，你的钱包应该会给你一个TXID，这就像是交易的唯一参考号码。你可以使用它在*区块链浏览器*上检查交易的状态。

## 2. 进行交易时会发生什么？
当您点击“发送”时，您的钱包会将您的交易发送到**比特币网络**中的一个节点。然后，它会从节点到节点进行中继，直到网络上的每个节点都拥有您的交易副本。
![Sending-2.gif](img/Sending-2%20(1).gif)

首先，您的交易被存储在每个节点的*memory pool*中，这类似于最近在网络上广播的交易的临时“等待区”。
![Sending-3.gif](img/Sending-3%20(1).gif)

大约10分钟后，网络上的一个节点将把它们内存池中的最新交易添加到它们的区块链上，并与其他节点共享这个新的交易块。
![Sending-4.gif](img/Sending-4%20(1).gif)

因此，每个节点都更新了它们的区块链，包括网络上的最新交易。这些交易现在已经得到确认。
![Sending-5.png](img/Sending-5%20(1).png)


最后，这个过程会不停地重复，以便新的交易块以每10分钟的规律不断地被加入到网络的区块链中。

>**因此，简而言之，在您进行交易后，您需要等待它被添加到区块链中，这被称为“确认”。**

## 3. 交易如何进入区块链？

每个节点都有机会尝试将其内存池中的交易添加到其区块链上。这个过程被称为*挖矿*。

为了将交易添加到区块链上，矿工将内存池中的交易收集到一个称为候选*块的容器*中。然后，节点使用能源来尝试将这个块“挖掘”到区块链的顶部。
![Sending-6.png](img/Sending-6%20(1).png)

>**提示**：网络上的任何节点都可以成为矿工。但如果您只想成为一个节点（而不是挖掘区块），那也很好。

因此，**挖矿**过程基本上是一个**全网范围的竞争**，网络上的任何节点都有机会挖掘下一个区块。能够更快挖矿的节点有更好的机会挖掘下一个区块，但挖矿的过程是**不可预测的**，因此没有单个节点控制将区块添加到区块链中。
![Sending-7.png](img/Sending-7%20(1).png)

大约经过10分钟（平均值），其中一台挖矿节点最终会挖出下一个区块并将其与所有其他节点共享。然后，每个节点都会检查该区块（以确保它已被正确挖掘）并将其添加到其区块链中。
![Sending-8.png](img/Sending-8%20(1).png)

现在每个人都拥有最新的区块。从这里开始，每个矿工构建一个新的候选区块（带有内存池中的新交易），并开始尝试将下一个区块挖掘到链上。

>**因此，总之，矿工们不断努力扩展区块链，添加新的交易区块。**

**为什么交易需要被挖掘？**

挖掘机制提供以下好处：

1. **防止冲突的交易被写入区块链。**如果两个冲突的交易被发送到网络中（例如尝试将相同的比特币发送到两个不同的地方），由于挖掘，只有其中一个交易实际上会被写入区块链。
2. **任何节点都可以挖掘下一个交易区块。**由于挖掘机制是不可预测的，任何节点都可以成为添加下一个区块的节点，这意味着没有单个节点控制添加到区块链的交易。
3. **交易不能轻易地从区块链中删除.**挖掘一个区块需要能源，这使得任何个人都很难获得足够的能源，以便能够快速挖掘区块并重写区块链。

总的来说，**挖掘**是使多台计算机同意一个不断更新的文件的方式，这对于依赖于跨计算机共享交易台账的数字货币至关重要。

有关详细信息，请参见*挖掘*。

## 4. 什么是交易费用？

一个比特币交易可以包含一笔比特币的费用。这个费用将被**矿工收取，并作为激励**，让矿工将您的交易包括在他们的候选块中。

为什么？

因为候选块只能容纳一定数量的交易（或者准确地说是数据），所以如果在任何给定时间有很多人进行交易，**那么内存池中的交易数量可能会超出块所能容纳的数量。**
![Sending-9.png](img/Sending-9%20(1).png)

因此，矿工会选择在候选区块中填充具有**最高费用**的交易，因为如果他们成功挖出该区块，他们可以通过*coinbase交易*收取这些费用。
![Sending-10.png](img/Sending-10%20(1).png)

>**提示**：内存池就像一个队列，有最高费用的交易在前面。

因此，当内存池中有很多交易时，您在交易中放置的费用越高，该交易被包括在块中的有效“优先级”就越高。
![Sending-11.gif](img/Sending-11%20(1).gif)

>**当您在交易中设置费用时，实际上是确定它在内存池中的位置以及您希望交易被挖掘的速度。**

**我应该在交易中放多少费用？**
这取决于**当前内存池中有多少交易**。
>Mempool Size:    50238 transactions (56.89 MB)
Candidate Block:  2932 transactions (1.51 MB)

一款好的钱包会根据当前内存池的大小，推荐不同的交易费用大小，以便根据您希望的交易被开采的速度进行选择。
>Within 2 Blocks:   111 sat/byte
Within 3 Blocks:   111 sat/byte
Within 4 Blocks:   106 sat/byte
Within 5 Blocks:   106 sat/byte
Within 10 Blocks:  79 sat/byte
Within 25 Blocks:  65 sat/byte
Within 144 Blocks: 16 sat/byte
Within 432 Blocks: 1 sat/byte

>我使用Bitcoin Core的bitcoin-cli estimatesmartfee命令获得上述费用估算。许多流行的比特币钱包使用此命令来提供有关费用的建议。

>**注意**：这些只是估计值。没有人能保证您的交易何时会被挖掘。更多的交易可能会进入网络，将您推向队列的后面。

但是，您始终可以选择在交易中设置自己的**自定义**费用。您可以查看内存池的当前状态，并决定您认为最好的费用：

* [Johoe的比特币内存池大小统计](https://jochen-hoenicke.de/queue/#0,24h)

但一般来说：

* 如果内存池中的交易数量**超过**候选块的容量，则您正在与内存池中的其他交易竞争进入块（因此费用金额将根据您希望交易被挖掘的速度而变化）。
* 如果内存池中的交易数量**少于***候选块*的容量，则可以设置最低费用（1 sat/byte）。
>**提示**：除非您真的需要，不要在交易中设置过高的费用。

>**注意**：交易按**sat/byte**排序，这是费用（以satoshis为单位）除以字节数的大小。这是因为矿工希望获得每个交易在块中占用的空间的最大费用。

**如果我在交易中设置的费用太低会发生什么？**

通过在交易中设置低费用，您将把它放在内存池的“队列末尾”。这没关系，但这意味着您将等待一个安静的时期，内存池将被清空，以便您的交易可以包含在一个块中。
![Sending-12.gif](img/Sending-12%20(1).gif)

然而，交易只会在节点的内存池中保留**72小时**（通常为3天[^3]），在此时间段之后，节点将从其内存池中删除该交易。因此，就好像您的交易从未发生过一样。
![Sending-13.png](img/Sending-13%20(1).png)

**警告**：在比特币交易被确认（即被挖掘进入区块链）之前，不要将其视为最终交易。如果手续费低和/或有大量交易被发送到网络中，则内存池中的交易可能最终不会被确认。

**提示**：如果您的交易在72小时内未被挖掘，您可以再次将其插入网络中，以获得再次挖掘的机会。

## 5. 我应该等待多少确认？

* **1个确认**通常足够。
* **2个确认**，如果您想要额外的保险，以防自然的*链重组*。
* **3个或以上的确认**，如果您担心网络规模的*攻击*会逆转您的交易。
“确认”是指您的交易被挖掘到一个区块中。如果在包含您的交易的区块上继续挖掘其他区块，就会出现额外的确认。
![Sending-14.gif](img/Sending-14%20(1).gif)

为什么这很重要？

好吧，我知道我说过你不能从区块链中删除交易，但从技术上讲，这是可能的。由于区块链的工作方式，一个拥有大量挖矿能力的*不良矿工*可以利用他们的能量来构建一个新的*更长的区块链*，供节点采用，并替换当前在链中的块（和交易）。

这在比特币中尚未发生过。
![Sending-15.png](img/Sending-15%20(1).png)

因此，通常建议等待**6个确认**（或更多）以确保交易无法被撤销，因为此时矿工无法替换该数量的区块。然而，除非您正在保护自己免受整个网络的恶意矿工攻击，否则这是过度保护。

等待**2个确认**来确保交易不会被撤销是更合理的时间。这是因为区块链中的顶部块往往会在自然链重组期间与另一个块交换位置。

>链重组大约每260.4天（每38,513个块）发生一次[^4]。

因此，当您的交易通过第一个块时，您可以确信它不会因自然原因被撤销。

![Sending-16.png](img/Sending-16%20(1).png)

## 6. 如何检查我的交易状态？

>**比特币最酷的一点是，你可以使用区块链浏览器查看交易的详细信息，无论它们是在内存池还是区块链中。**

当你进行比特币交易时，你的钱包应该会给你提供该交易的*TXID*。这就像是交易的唯一参考号，你可以使用它在**区块链浏览器**中找到该交易：

*learnmeabitcoin.com/explore*r - 我制作的一个浏览器。我设计它是为了快速简单。
[blockstream.info](https://blockstream.info/) - 另一个流行的浏览器，虽然更专注于技术细节。
现在，区块链浏览器基本上只是一个作为比特币节点窗口的网站。因此，通过输入你的TXID，你只是要求浏览器查看其已收到的区块链（或内存池）中的交易，并向你显示交易的详细信息。
![Sending-17.png](img/Sending-17%20(1).png)

我不会涵盖探险家可以向您展示的所有细节，但我认为最有用的一些东西是：

* **确认的数量。**该交易是否在内存池中或已挖掘到块中？
* **比特币的流动。**比特币来自哪个地址，锁定到哪个地址？
* **比特币的锁定。**比特币是如何锁定的[^5]？

无论如何，您的钱包可能会告诉您有关交易的基本信息（例如是否已确认），但区块链浏览器允许您深入了解交易的详细信息，这非常酷。

>您还可以在自己的比特币核心节点中找到交易：bitcoin-cli gettransaction [txid]

## 总结：
以下是我最好的建议：

* 使用你感到舒适的*钱包*。
* 设置最低的手续费，只要能够通过即可。
* 通过区块链浏览器跟踪交易的进展。
    * 大多数情况下，1次确认就足够了。
    * 如果你想在极少数的自然链重组的情况下更加确保，2次确认是更好的选择。
    * 除非你担心有人会策划一场网络规模的攻击来撤销你的交易，否则3次以上的确认就是多余的。

在你的前几次交易后，你会逐渐熟悉它。

这是一份非常好的指南（不用谢），但是经验是最好的老师。

[^1]:一个区块过去只能容纳1MB的数据，但是由于隔离见证技术的出现，计算区块可以容纳多少数据的方法已经在2017年7月发生了变化。因此，一个区块现在可以容纳大约1.7MB的交易数据。

[^2]:每个节点都可以使用-maxmempool选项设置其内存池的最大大小（默认为300MB）。

[^3]:每个节点都可以使用-mempoolexpiry选项设置它们保留内存池交易的时间（默认为72小时）。

[^4]:您可以通过运行bitcoin-cli getchaintips并查看有效分叉的数量来查看您的节点经历了多少次链重组。这些数据基于我自2016年12月17日以来一直在运行的节点。

[^5]:比特币可以以多种不同的方式被锁定。请参阅Script以获取更多信息。
