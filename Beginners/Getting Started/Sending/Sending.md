# <center>发送</center>
<center>进行你的第一笔比特币交易。</center>

你已经[拥有了一些比特币](../Buying/Buying.md)。现在你想将它们转移到另一个地址。

为此，你需要进行一笔**交易**。

1. [如何进行交易？](#1-如何进行交易)
2. [进行交易时会发生什么？](#2-进行交易时会发生什么)
3. [交易如何进入区块链？](#3-交易如何进入区块链)
4. [什么是交易手续费？](#4-什么是交易手续费)
5. [我应该等待多少确认？](#5-我应该等待多少确认)
6. [如何检查我的交易状态？](#6-如何检查我的交易状态)

## 1. 如何进行交易？

无论你使用哪种[比特币钱包](../getting-started/getting%20started.md)，操作步骤都大同小异：

1. **输入地址**。你要“发送”比特币到什么地方。
2. **输入金额**。你要发送的比特币数量。通常以BTC或Satoshis为单位。
3. **设置手续费。（可选**）这将设置交易的“优先级”，以确定交易何时被最终确认。

然后只需点击“发送”即可完成。

![Sending-1.png](img/Sending-1%20(1).png)

<center>所有钱包具有大致相同的功能。</center>

从这里开始，你只需要等待交易被确认...

>**注意**：当你发送交易时，你的钱包会给你一个TXID，这就像是交易的唯一参考号码。你可以使用它在[区块链浏览器](https://learnmeabitcoin.com/explorer)上检查交易的状态。

## 2. 进行交易时会发生什么？
当你点击“发送”时，你的钱包会将你的交易信息发送到**比特币网络**中的一个节点。然后由这个节点将交易信息向其他节点传递，直到网络上的每个节点都拥有你的交易副本。  

![Sending-2.gif](img/Sending-2%20(1).gif)  

<center>节点将交易信息传递给其他节点。</center>

首先，你的交易被存储在每个节点的[**内存池**](../../../Technical/Node/Memory%20Pool/Memory%20Pool.md)中，这用于存放最近在网络上广播的交易的临时“等待区”。

![Sending-3.gif](img/Sending-3%20(1).gif)

<center>每个节点都有自己的内存池。</center>

大约10分钟后，网络上的一个节点将把它们内存池中的最新交易添加到它们的区块链上，并与其他节点共享这个新的[交易块](../../How%20Bitcoin%20Works/2.Mining/2.Blocks/Blocks.md)。

![Sending-4.gif](img/Sending-4%20(1).gif)

<center>节点会在新的交易块添加到其区块链之前对其进行验证。</center>

因此，每个节点都更新了它们的区块链，包括网络上的最新交易。这些交易现在已经得到确认。

![Sending-5.png](img/Sending-5%20(1).png)

<center>区块链是比特币交易的永久存储。</center>

最后，这个过程会不停地重复，以便新的交易块以10分钟的间隔不断地被添加到网络上的区块链中。

>**简而言之，在你进行交易后，你需要等待它被添加到区块链中，这被称为“确认”。**

## 3. 交易如何进入区块链？

每个节点都有机会尝试将其内存池中的交易添加到其区块链上。这个过程被称为[挖矿](../../How%20Bitcoin%20Works/2.Mining/mining.md)。

为了将交易添加到区块链上，矿工将内存池中的交易收集到称为[候选区块](../../../Technical/Node/Candidate%20Block/Candidate%20Block.md)的容器中。然后，节点使用能源来尝试将这个块“挖掘”到区块链的顶部。  

![Sending-6.png](img/Sending-6%20(1).png)

<center>矿工必须努力工作，尝试将新的区块添加到区块链上。</center>

>**提示**：网络上的任何节点都可以成为矿工。但如果你只想成为一个节点（而不挖掘区块）也没问题。

**挖矿**过程是一个**全网范围的竞争**，网络上的任何节点都有机会挖掘下一个区块。挖掘速度更快的节点更有机会挖掘下一个区块，但挖矿的过程是**不可预测的**，因此没有任何一个节点可以确定自己一定能成功挖到新的区块并添加到区块链中。

![Sending-7.png](img/Sending-7%20(1).png)

<center>任何一位矿工都有可能成为挖掘下一个区块的人。</center>

大约经过10分钟（平均值），其中一台挖矿节点最终会挖出下一个区块并将其与所有其他节点共享。然后，每个节点都会检查该区块（以确保它已被正确挖掘）并将其添加到其区块链中。

![Sending-8.png](img/Sending-8%20(1).png)

<center>网络中的节点使用新挖掘的区块更新他们的区块链。</center>

现在每个人都拥有最新的区块。从这里开始，每个矿工构建一个新的候选区块（包含内存池中的新交易），并开始尝试将下一个区块挖掘到链上。

>**总之，矿工们不断努力添加新的交易区块来扩展区块链。**

**为什么交易需要被挖掘？**

挖矿机制提供以下好处：

1. **防止冲突的交易被写入区块链**。如果两个冲突的交易被发送到网络中（例如尝试将相同的比特币发送到两个不同的地方），由于挖掘，只有其中一个交易实际上会被写入区块链。
2. **任何节点都可以挖掘下一个交易区块**。由于挖掘机制是不可预测的，任何节点都可以添加下一个区块，这意味着没有任何一个节点可以控制添加到区块链的交易。
3. **交易不能轻易地从区块链中删除**。挖掘区块需要能源，这使得任何个人都很难获得足够的能源以足够快的速度挖掘区块来重写区块链。

总的来说，**挖掘**让多台计算机能对定期更新的文件达成一致，这对于依赖于跨计算机共享交易台账的数字货币至关重要。

有关详细信息，请参见[挖掘](../../../Technical/Mining/Mining.md)。

## 4. 什么是交易手续费？

比特币交易可以包含一笔比特币作为手续费。这个手续费将被**矿工收取，并作为激励**，让矿工将你的交易包括在他们的候选块中。

为什么？

因为候选块只能容纳一定数量的交易（或者准确地说是数据），如果很多人同时进行交易，**那么内存池中的交易数量可能会超出块所能容纳的数量。**  

![Sending-9.png](img/Sending-9%20(1).png)  

一个区块可以容纳大约1MB的交易数据[^1]，但是内存池可以容纳300MB[^2]。

因此，矿工会选择在候选区块中填充具有**最高手续费**的交易，因为如果他们成功挖出该区块，他们可以通过[coinbase交易](../../../Technical/Transaction/Coinbase%20Transaction/Coinbase%20Transaction.md)收取这些手续费。

![Sending-10.png](img/Sending-10%20(1).png)

<center>大部分矿工希望从挖矿中赚取尽可能多的钱。</center>

>**提示**：内存池就像一个队列，手续费最高的交易在前面。

因此，当内存池中有很多交易时，你对交易支付的手续费越高，该交易被包含在块中的有效“优先级”就越高。

![Sending-11.gif](img/Sending-11%20(1).gif)

<center>好的钱包将允许你设置自己的手续费，并给出交易被挖掘的预计时间。</center>

>**当你在交易中设置手续费时，实际上是确定它在内存池中的位置以及你希望交易被挖掘的速度。**

**应该在交易中放多少手续费？**  
这取决于**当前内存池中的交易数量**。
>Mempool Size:    50238 transactions (56.89 MB)  
Candidate Block:  2932 transactions (1.51 MB)

一个好的钱包会根据你想要的交易速度和当前内存池的大小，推荐适合的交易手续费。  

>Within 2 Blocks:   111 sat/byte  
Within 3 Blocks:   111 sat/byte  
Within 4 Blocks:   106 sat/byte  
Within 5 Blocks:   106 sat/byte  
Within 10 Blocks:  79 sat/byte  
Within 25 Blocks:  65 sat/byte  
Within 144 Blocks: 16 sat/byte  
Within 432 Blocks: 1 sat/byte

>我使用Bitcoin Core的bitcoin-cli estimatesmartfee命令获得上述手续费估算。许多流行的比特币钱包使用此命令来提供有关手续费的建议。

>**注意**：这些只是估计值。没有人能保证你的交易何时会被挖掘。更多的交易可能会进入网络，将你推向队列的后面。

但是，你始终可以选择在交易中设置自己的**自定义**手续费。你可以查看内存池的当前状态，并决定你认为最适合的手续费：

* [Johoe的比特币内存池大小统计](https://jochen-hoenicke.de/queue/#0,24h)

但总的来说：

* 如果内存池中的交易数量**超过**候选块的容量，则你正在与内存池中的其他交易竞争进入块（因此手续费金额将根据你想要的交易速度而变化）。
* 如果内存池中的交易数量**少于**[候选块](../../../Technical/Node/Candidate%20Block/Candidate%20Block.md)的容量，则可以设置最低手续费（1 sat/byte）。

>**提示**：除非你真的有需求，否则不要在交易中设置过高的手续费。

>**注意**：交易按**sat/byte**排序，这是手续费（以satoshis为单位）除以字节数的大小。这是因为矿工希望获得每个交易在块中占用的空间的最大手续费。

**如果在交易中设置的手续费太低会发生什么？**

通过在交易中设置低手续费，你将把它放在内存池的“队列末尾”。这没关系，但这意味着你需要等待内存池清空后才能将你的交易包含在区块中。  

![Sending-12.gif](img/Sending-12%20(1).gif)  

<center>如果内存池中没有更高手续费的交易，则低手续费的交易最终会被包含在区块中。</center>

然而，交易只会在节点的内存池中保留**72小时**（通常为3天[^3]），在此时间段之后，节点将从**其内存池中删除该交易**。因此，就好像你的交易从未发生过一样。  

![Sending-13.png](img/Sending-13%20(1).png) 

<center>交易只在内存池中等待固定的时间。</center>

**警告**：在比特币交易被确认（即被挖掘进入区块链）之前，不要将其视为最终交易。如果手续费设置很低或者有大量交易被发送到网络中，则内存池中的交易可能最终不会被确认。

**提示**：如果你的交易在72小时内未被挖掘，你可以再次将其插入网络中，以获得再次挖掘的机会。

## 5. 我应该等待多少确认？

* 通常**1次确认**就够了。
* **2次确认**，如果你想要有额外的保障，以防自然的[链重组](../../../Technical/Blockchain/chain-reorganisation/chain-reorganisation.md)。
* **3次或以上的确认**，如果你担心网络规模的[攻击](../../../Technical/Blockchain/51-attack/51-attack.md)会逆转你的交易。

“确认”是指你的交易被挖掘到一个区块中。如果在包含你的交易的区块上继续挖掘其他区块，就是额外的确认。

![Sending-14.gif](img/Sending-14%20(1).gif)

<center>确认数是指你的交易在区块链中的深度。</center>

为什么这很重要？

好吧，我知道我说过你不能从区块链中删除交易，但从技术上讲，这是可能存在的。由于区块链的工作方式，拥有大量挖矿能力的[恶意矿工](../../../Technical/Blockchain/51-attack/51-attack.md)可以利用他们的能源来构建一个新的[更长的区块链](../../../Technical/Blockchain/longest-chain/longest-chain.md)，供节点采用，并替换当前在链中的块（和交易）。

这在比特币中尚未发生过。  

![Sending-15.png](img/Sending-15%20(1).png)

<center>随着交易在区块链中的深入，矿工要移除它的难度呈指数级增加。</center>
  
因此，通常建议等待**6次确认**（或更多）以确保交易无法被撤销，因为此时矿工无法替换该数量的区块。然而，除非你正在保护自己免受整个网络的恶意矿工攻击，否则这是过度保护。

等待**2次确认**来确保交易不会被撤销是更合理的时间。这是因为在自然[链重组](../../../Technical/Blockchain/chain-reorganisation/chain-reorganisation.md)期间，区块链顶部的区块有可能会与其他区块发生改变。

>链重组大约每260.4天（每38,513个块）发生一次[^4]。

因此，当你的交易通过第一个块时，你可以确信它不会因自然原因被撤销。

![Sending-16.png](img/Sending-16%20(1).png)

<center>链重组发生在两个区块同时被挖掘并竞争同一位置的情况下。</center>

## 6. 如何检查我的交易状态？

>**比特币最酷的一点是，你可以使用区块链浏览器查看交易的详细信息，无论它们是在内存池还是区块链中。**

当你进行比特币交易时，你的钱包会给你提供该交易的[TXID](../../../Technical/Transaction/TXID/TXID.md)。这就像是交易的唯一参考号，你可以使用它在**区块链浏览器**中找到该交易：

* [learnmeabitcoin.com/explorer](https://learnmeabitcoin.com/explorer) - 我制作的一个浏览器。我设计它是为了快速简单。
* [blockstream.info](https://blockstream.info/) - 另一个流行的浏览器，虽然更专注于技术细节。

简单来说，区块链浏览器就是一个可以查看比特币节点的网站。因此，通过输入你的TXID，你就是在请求浏览器查看其区块链（或内存池）并展示它已经接收到的交易详情。

![Sending-17.png](img/Sending-17%20(1).png)

<center>区块浏览器只显示它们内存池和区块链中的数据。</center>

我不会涵盖探索者可以向你展示的所有细节，但我认为最有用的一些东西是：

* **确认次数**。该交易是否在内存池中或已挖掘到块中？
* **比特币的转移**。比特币来自哪个地址，锁定到哪个地址？
* **比特币的锁定情况**。比特币是如何锁定的[^5]？

无论如何，你的钱包可能会告诉你有关交易的基本信息（例如是否已确认），但区块链浏览器允许你深入了解交易的详细信息，这非常酷。

>你还可以在自己的比特币核心节点中找到交易：bitcoin-cli gettransaction [txid]

## 总结：
以下是我最好的建议：

* 使用你感到舒适的[钱包](../getting-started/getting%20started.md)。
* 设置尽可能低的手续费，只要能够通过即可。
* 通过[区块链浏览器](https://learnmeabitcoin.com/explorer)跟踪交易的进展。
    * 大多数情况下，1次确认就足够了。
    * 如果你想在极少数的自然[链重组](../../../Technical/Blockchain/chain-reorganisation/chain-reorganisation.md)的情况下更加确保，2次确认是更好的选择。
    * 除非你担心有人会策划一场[网络规模的攻击](../../../Technical/Blockchain/51-attack/51-attack.md)来撤销你的交易，否则3次以上的确认就是多余的。

经过最初的几次交易后，你会逐渐熟悉它。

这是一份非常好的指南（不用谢），但经验是最好的老师。

[^1]:一个区块过去只能容纳1MB的数据，但是由于[隔离见证]()技术的出现，计算区块可以容纳多少数据的方法已经在2017年7月发生了变化。因此，一个区块现在可以容纳大约1.7MB的交易数据。

[^2]:每个节点都可以使用-maxmempool选项设置其内存池的最大大小（默认为300MB）。

[^3]:每个节点都可以使用-mempoolexpiry选项设置它们保留内存池交易的时间（默认为72小时）。

[^4]:你可以通过运行bitcoin-cli getchaintips并查看有效分叉的数量来查看你的节点经历了多少次链重组。这些数据基于我自2016年12月17日以来一直在运行的节点。

[^5]:比特币可以以多种不同的方式被锁定。请参阅Script以获取更多信息。
