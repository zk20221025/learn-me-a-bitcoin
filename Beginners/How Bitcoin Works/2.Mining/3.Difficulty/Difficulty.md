# <center>难度</center>
<center>一个用于调节挖掘区块所需时间的机制。</center>

## 什么是难度？
**难度是一个数字，它调节矿工需要多长时间将新的交易[块](../2.Blocks/Blocks.md)添加到[区块链](../1.Blockchain/Blockchain.md)中。**

![difficulty-1.png](img/difficulty-1%20(1).png)

这个难度值每两周更新一次，以确保平均需要10分钟将新区块添加到区块链中。

## 为什么难度很重要？

>**因为它确保即使有更多的挖矿者加入网络，交易块也会定期添加到区块链中，。**

如果难度保持不变，随着新的挖矿者加入网络，添加新块到区块链之间的时间将缩短。

## 难度什么时候改变?
**难度调整发生在每2016个区块（大约每2周）。**

在此间隔期内，每个节点将预期的时间（2016 x 10分钟）除以实际用时的时间（无论多少分钟）：
```
expected / actual
20160 / actual
```

如果矿工能够比预期更快地解决每个区块，比如每个区块只需要9分钟，那么你会得到一个类似这样的数字。
```
20160 / 18144 = 1.11
```

每个节点随后使用这个数字来调整接下来的2016个区块的难度：
```
difficulty x 1.11 = new difficulty
```

* 如果数字大于1（即挖掘的区块比预期更快），难度增加。
* 如果数字小于1（即挖掘的区块比预期更慢），难度降低。

就是这样。比特币网络上的每个矿工现在都将使用这个新的难度来挖掘接下来的2016个区块。

>难度调整最多只会增加4倍（即数字不大于4或不小于0.25）。这是为了防止难度从一个极端到另一个极端的突然变化。

## 难度如何控制区块之间的时间？
好的，我会从简单的例子开始，然后逐步解释。

### 1. 简单的例子
假设我给你一个从1到100的数字范围。

![difficulty-2.png](img/difficulty-2%20(1).png)

现在，你可以每分钟随机生成一个1到100之间的数字。**你的目标是生成一个低于我的目标数字的数字**。

比如说，如果我设置目标为**50**：

![difficulty-3.png](img/difficulty-3%20(1).png)

考虑到你每分钟只能生成1到100之间的一个数字，这应该需要**2分钟**时间。

但这太容易了。现在我将目标降低到**20**，这意味着你只能有1/5的几率生成一个获胜数字，或者每**5分钟**才能生成一次：

![difficulty-4.png](img/difficulty-4%20(1).png)

目标越低，生成获胜号码就越困难。

>每次都不一定需要5分钟，因为你可能会在第一个生成的数字就得到幸运数字。但是长期来看，平均每5分钟就会有一个幸运数字。

因此，根据你每分钟能够生成多少数字，我可以使用目标高度来控制你找到获胜数字所需的时间。

**引入难度…**  
我是一台计算机，而且我发现通过**使用一个新数字来分割数字范围**来给你目标值更容易一些，而不是直接告诉你目标值。

![difficulty-5.png](img/difficulty-5%20(1).png)

这个新的数字能够控制目标的高度。

**这个新数字是难度，它被用作我修改目标高度的简便方法。**

这是用于找到目标的方程式：
```
target = targetmax / difficulty
```

此外，我可以使用这个难度值来帮助我设定任何我想要的目标水平：

![difficulty-6.png](img/difficulty-6%20(1).png)

难度越高，目标就越低。

因此，我使用难度来控制目标，以此来控制生成中奖号码所需的时间。

## 2. 比特币示例。
比特币的难度以完全相同的方式工作——它用于设定一个目标值，而矿工不断产生数字（对候选[块](../2.Blocks/Blocks.md)进行哈希），希望他们会找到一个比这个目标值更低的数字：

![difficulty-7.png](img/difficulty-7%20(1).png)

由于矿工能够每分钟生成数千个数字（哈希值），因此比特币使用了极其巨大的数字。

![difficulty-8.png](img/difficulty-8%20(1).png)

比特币中的数字只是在更大的规模上。

由于现在有成千上万的矿工试图找到获胜的数字，为了确保每10分钟找到一个获胜的数字（而不是每几秒钟），成功数字的范围最终变得非常小：

![difficulty-9.png](img/difficulty-9%20(1).png)

尽管难度数字看起来很大，但目标仍然极难达成。这就像中了彩票一样难。

### 介绍十六进制数...

由于这些目标数字非常大，计算机更喜欢以十六进制格式进行计算。

![difficulty-10.png](img/difficulty-10%20(1).png)

这就是为什么块的哈希值看起来像这样：000000000003ba27aa200b1cecaad478d2b00432346c3f1f3986da1afd33e506——这是十六进制的。

即使它包含字母，它仍然是一个数字。因此，目标是一个十六进制值，而矿工们正在努力获得低于目标值的**十六进制哈希值**。

实际上，你可以很容易地在十六进制和“普通数字”（更为人所知的是十进制数字）之间进行转换：

|Target for [block 100,000](http://blockexplorer.com/b/100000)||
|---|---|
|**Hexadecimal**|000000000004864c000000000000000000000000000000000000000000000000|
|**Decimal**|1861311314983800126815643622927230076368334845814253369901973504

|Hash for [block 100,000](http://blockexplorer.com/b/100000)||
|---|---|
|**Hexadecimal**|000000000003ba27aa200b1cecaad478d2b00432346c3f1f3986da1afd33e506|
|**Decimal**|1533267872647776902154320487930659211795065581998445848740226310|

这就是为什么你通常会看到哈希和目标以一堆数字和字母的形式出现 - 它们是十六进制的，而不是人类更熟悉的十进制。但请记住，这两种十进制和十六进制数字具有相同的**值**，并且你可以轻松地在两者之间进行转换。

>尴尬的是，难度通常以十进制格式给出，而哈希和目标以十六进制存储。但正如我所说，它们都是数字，只要将它们转换为相同的格式，你仍然可以使用它们。

![difficulty-11.png](img/difficulty-11%20(1).png)  

区块100,000的头部。目标是十六进制的，但它以紧凑格式存储在块头（称为比特）中。

**例子：利用难度找到目标。**
使用难度值计算出[第100,000个区块](http://blockexplorer.com/b/100000)的目标值。但让我们主要使用十进制数字，因为它们更容易理解。

以下是第100,000个区块的难度值（在块头中找到）：
```
{
"hash" : "000000000003ba27aa200b1cecaad478d2b00432346c3f1f3986da1afd33e506",
"height" : 100000,
"difficulty" : 14484.16236123,
}
```
好的。

现在，记下用于查找目标的方程式：
```
target = targetmax / difficulty
```
准备好目标最大值和难度，以便将其插入方程式中。
```
targetmax = 0x00000000FFFF0000000000000000000000000000000000000000000000000000
difficulty = 14484.162361
```
* 目标最大值是固定的值，可以在这里找到。
* 我从上面贴的区块头信息中获取了难度。  

目标最大值目前是十六进制格式，因此让我们将其转换为十进制。
```
targetmax = 26959535291011309493156476344723991336010898738574164086137773096960
```
>我使用了这个[十六进制转十进制的转换器](https://learnmeabitcoin.com/tools/hexdec)来完成这个任务。

>我知道目标最大值是一个十六进制数字，因为它以0x开头，这是一个前缀，表示接下来的内容是十六进制（0x不是数字的一部分，只是一个注释）。此外，数字中存在字母也是一个明显的提示。

现在只需将这些数字代入方程即可：
```
target = targetmax / difficulty
target = 26959535291011309493156476344723991336010898738574164086137773096960 / 14484.162361
target = 1861311315012765306929610463010191006516769515973403833769533170
```

因此，当矿工尝试解决第100,000个区块时，她想要为候选区块获取一个哈希值，该哈希值应该低于1861311315012765306929610463010191006516769515973403833769533170.

**检查一下**  
让我们将这个哈希值与她为区块获得的哈希值进行比较，以检查她是否真正成功（即她为区块获得的哈希值低于目标值）。
```
target = 1861311315012765306929610463010191006516769515973403833769533170
hash   = 000000000003ba27aa200b1cecaad478d2b00432346c3f1f3986da1afd33e506
```
哦，是的，哈希值是十六进制格式的。抱歉。让我再次将其从[十六进制转换为十进制](https://learnmeabitcoin.com/tools/hexdec)，以便比较这两个数字：
```
target = 1861311315012765306929610463010191006516769515973403833769533170
hash   = 1533267872647776902154320487930659211795065581998445848740226310
```
是的，这个哈希值比目标值略小一些。但是它比目标值低，所以哈希值是成功的，该区块可以添加到区块链中。

>目标哈希和区块哈希都将作为十六进制数字存储在块头中，因此，如果我们将它们都转换回十六进制，它们将如下所示：
```
target = 4864C00004D6AC7CD33F734B8EB28B24729FE151953EC57A21EF2
hash   = 3BA27AA200B1CECAAD478D2B00432346C3F1F3986DA1AFD33E506
```

### 我在哪里可以找到当前的难度？
你可以通过在比特币客户端中输入getdifficulty命令来查找当前的难度：

>难度也可以在getmininginfo（在其他挖矿信息中）中找到。

![difficulty-12](img/difficulty-12%20(1).png)

* 如果你没有比特币客户端，你可以在这里查找难度：http://chainquery.com/bitcoin-api/getdifficulty

* 如果你对难度的变化感兴趣，这是一个带有图表的网站：https://bitcoinwisdom.com/bitcoin/difficulty
