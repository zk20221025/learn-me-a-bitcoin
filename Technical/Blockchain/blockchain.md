# <center>区块链</center>
<center>比特币交易记录文件。</center>

![blockchain-S-1.png](img/blockchain-S-1%20(1).png)

区块链是一个[交易](../../Beginners/How%20Bitcoin%20Works/3.Transactions/Transactions.md)记录文件。它是比特币[节点](../../Beginners/How%20Bitcoin%20Works/1.Network/Nodes/Nodes.md)维护的最重要的文件。

它被称为“区块链”，因为新的交易以[块](../../Beginners/How%20Bitcoin%20Works/2.Mining/2.Blocks/Blocks.md)的形式添加到文件中，这些块相互连接堆叠形成一个块链。因此，叫做区块链。

但归根结底，，区块链是**比特币交易文件的永久存储**。

![blockchain-S-2.png](img/blockchain-S-2%20(1).png)

## 如何获取区块链的副本？

![blockchain-S-3.png](img/blockchain-S-3%20(1).png)

当你运行比特币时，节点会从网络上的其他节点下载区块，直到拥有最新的区块链副本。

当节点相互连接时，它们在初始握手期间告诉彼此它们的区块链高度（拥有多少个区块）。如果另一个节点比你有更多的区块，你的节点将从其他节点请求这些区块，直到你拥有完整的区块链副本。

因此，节点不断地相互通信，以在网络上的每台计算机上复制区块链。

>**提示**：“区块链”没有单一或确定的版本。每个节点都保留其自己的本地区块链副本，这些副本在任何给定时间都可能因计算机而异。

>**注意**：我的节点的[区块链](./blockchain.md)目前为**0.00 GB**，因此第一次运行比特币时可能需要一段时间下载。这被称为[初始区块下载](https://btcinformation.org/en/developer-guide#initial-block-download)（或IBD）。

## 如何将新块添加到区块链？

![blockchain-S-4.png](img/blockchain-S-4%20(1).png)

新的交易块必须先被[挖掘](../Mining/Mining.md),然后才能添加到区块链中。

简而言之，挖掘的过程包括从[内存池](../Node/Memory%20Pool/Memory%20Pool.md)中收集交易到一个[候选块](../Node/Candidate%20Block/Candidate%20Block.md)中，然后利用处理能力生成一个[块哈希](../Block/block-hash/block-hash.md)，使其低于特定的[目标值](../Mining/Target/Target.md)。这意味着网络上的任何节点都可以挖掘新的块，但需要消耗能量才能做到。

当节点（或“矿工”）成功挖掘出新块时，它们将与网络上的其他节点共享。当其他节点收到这个新块时，它们将把它添加到它们的区块链中，然后开始尝试在其上挖掘新的块。

![blockchain-S-5.png](img/blockchain-S-5%20(1).png)

因此，矿工不断努力通过全新的交易块来扩展区块链。

>**注**：由于挖掘区块所需的[难度](../../Beginners/How%20Bitcoin%20Works/2.Mining/3.Difficulty/Difficulty.md)和处理能力，平均每10分钟才会添加一个新的块到区块链中。

>**注**：节点不必尝试挖掘新块。相反，它可以仅保留区块链的副本，并在收到新块时将其传播到其他节点。

## 两个区块能同时被挖掘吗？

![blockchain-S-7.png](img/blockchain-S-7%20(1).png)

是的，这是完全正常的。

在这种情况下，节点将考虑到他们接收到的第一个区块作为其区块链的一部分，但也会保留他们接收到的第二个区块，以防万一。然而，第二个到达的区块（以及其中的交易）将不被视为他们**活动**的区块链的一部分。

因此，网络上的节点实际上会就哪个区块应该处于链顶部而存在分歧。

这种分歧在下一个区块被挖掘时得以解决。下一个区块将在其中一个区块之上构建，创建一个新的[最长区块链](./longest-chain/longest-chain.md)，并且作为规则，**节点将始终采用已知的最长区块链作为其活动区块链**。

因此，一些节点将执行[链重组](./chain-reorganisation/chain-reorganisation.md)，以将旧活动链中的区块移出，以支持新的更长的链中的区块。

因此，尽管在任何给定时间内可能存在关于哪些区块应位于区块链顶部的分歧，但新区块的挖掘和最长链的采用意味着节点将始终达成一致。

![blockchain-S-8.png](img/blockchain-S-8%20(1).png)

<center>节点始终采用最长的区块链作为区块链的接受版本。</center>

## 这是否意味着区块链中的块可以被替换？
是的。

由于节点始终采用最长的链，因此你始终可以尝试构建一个新的更长的区块链以替换现有的区块链，而网络上的每个节点都将采用它。实际上，这将允许你从区块链中“撤消”或逆转比特币交易。

![blockchain-S-9.png](img/blockchain-S-9%20(1).png)

<center>如果你建立了一个新的最长的区块链，其他节点将会采用它。</center>

然而，问题在于所有矿工都有动力始终在最长链上进行构建。这意味着网络上的矿工的综合处理能力将集中在构建一个链上，这条链将比任何你自己构建的链要建得更快。

![blockchain-S-10.png](img/blockchain-S-10%20(1).png)

<center>其他所有矿工都在努力扩展当前最长的区块链。</center>

换句话说，构建区块链网络的联合处理能力有助于保护已经挖掘到区块链上的块（和交易）。

为此，你想要进行有意的链重新组织（以“撤消”现有块中的交易）的唯一方法是拥有比其他所有矿工加起来更多的处理能力（算力），这样你就可以超越网络并建立一个更长的链供所有人采用。

这被称为[“51% Attack”](./51-attack/51-attack.md)。

## 区块链在哪里？
区块链文件通常可以在以下位置找到：

* **Linux**：~/.bitcoin/blocks/
* **Mac**：~/Library/Application Support/Bitcoin/
* **Windows**：C:\Users\[用户名]\AppData\Roaming\Bitcoin\
>**注意**：区块链被分成多个文件，命名为blk00000.dat，blk00001.dat，blk00002.dat等等。这是因为用较小的文件比用一个巨大的文件更容易处理[^1]。

### 摘要
区块链是比特币交易的永久存储文件。新的交易被添加到文件中的区块中，这些区块会相互叠加形成链。

新的区块通过挖矿加入到区块链中，这需要使用计算机处理能力。这意味着挖矿需要消耗能量，但网络中的任何节点都可以尝试添加下一个区块到链上。

当一个新的区块被挖出来后，它会在网络中传播，节点会验证并将其添加到他们的链上。通过这种方式，区块链是一份不断增长的交易账本，分布在网络上的多台计算机上。

节点总是采用最长的区块链作为唯一版本，这解决了关于哪些区块应该在链的顶部的争议。这也保护了已经存在于区块链中的区块，因为要用大量的资源来构建替换已经存在的区块的链。

因此，区块链是一个经常更新的交易文件。挖掘区块和采用最长的链的系统**允许网络上的多台计算机被视为活跃的同一组区块和交易达成一致**，同时也使得任何人难以对文件中的区块和交易进行历史性的更改。

![blockchain-S-11.png](img/blockchain-S-11%20(1).png)(https://learnmeabitcoin.com/technical/images/blockchain/blockchain.gif)

点击图像查看区块链建设的gif动画。

[^1]:https://bitcoin.stackexchange.com/questions/50693/why-are-blk-dat-files-134200000-bytes